# hateblog リニューアル機能一覧

UI/デザインは再検討対象のため、本書では機能要素のみを記載する。

## 共通
- サイトロゴ・説明文の表示
- キーワード検索フォーム（テキスト入力＋検索実行）
- グローバルナビゲーション：新着順リスト、人気順リスト、アーカイブ、ランキング、閲覧履歴（ログインは廃止予定）

## エントリー表示共通要素
- タイトル・外部記事へのリンク（新規タブ想定）
- 投稿日時表示
- はてなブックマーク件数の表示
- ブックマーク追加リンク（はてな）
- 共有／保存：Web Share API + SNS 公式シェア URL（Twitter、Facebook、Pocket、Instapaper、Evernote など必要最小限）
- タグ一覧表示＋タグ別一覧ページへの導線
- 記事本文冒頭の抜粋＋「続きを読む」で元記事へ
- favicon 表示（記事ドメインに紐づくアイコン取得）
- クリック計測（リストからのクリックを計測するエンドポイント呼び出し）

## リスト／フィルタ
- 新着順リスト：指定日付のエントリー一覧
- 人気順リスト：指定日付のエントリーを人気順に並べた一覧
- はてなブックマーク件数による閾値フィルタ（例：5/10/50/100/500/1000 users）を共通で適用可能
- ページネーションは再考前提（25件固定などの仕様は引き継がない）

## アーカイブ
- 年→月→日での階層ナビゲーション
- 日単位での件数表示
- 各日付から新着順／人気順リストへのリンク
- 閾値フィルタ（5〜1000 users）の適用

## ランキング
- 年次「はてブ・オブ・ザ・イヤー」ページ
- 月間ランキング TOP 5、週間ランキング TOP 3 のリンク
- 年→月→週の階層リンクで各ランキングページに遷移

## 閲覧履歴
- ユーザーの閲覧履歴を保存し、一覧表示（ログインなし前提、localStorage で保持）
- 期間表示（例：表示範囲の日付）
- ページ遷移（ページネーション仕様は再考）
- エントリー表示要素はリストと同等（共有・タグ・続きを読む等）

## タグ
- タグ別一覧ページ（`/tag/{tag}`）の提供
- エントリーからのタグクリックで遷移可能

## 検索
- キーワード検索フォーム（サイト内エントリーの全文／タイトル／タグ検索いずれかは別途定義）

## バッチ処理（定期処理）
- はてなブックマーク公開RSSフィードからのエントリー自動取得（15分ごと）
  - データソース: はてなブックマーク公開フィード（ホットエントリー）
  - 取得内容: タイトル、URL、ブックマーク件数、投稿日時、抜粋
  - 重複チェック: URL単位での重複排除
  - 差分更新: 既存エントリーのブックマーク件数を自動更新
- ブックマーク件数の優先度別更新（複数バッチを並行実行）
  - はてなブックマーク一括取得API（最大50URL/リクエスト）を利用
  - updated_at（最終更新日時）が古い順に取得して循環更新
  - 優先度別の更新戦略:
    - 高優先度: 新着30日以内または100users以上（15分ごと、100件/回）
    - 中優先度: 90日以内または20users以上（1時間ごと、50件/回）
    - 低優先度: 180日以内または10users以上（3時間ごと、50件/回）
    - 全体循環: 5users以上の全エントリー（6時間ごと、50件/回）
  - 合計: 約11,400件/日のペースで更新
- タグの自動抽出・登録
  - Yahoo! キーフレーズ抽出APIを利用
  - エントリーのタイトルと抜粋から上位3-5個のキーフレーズを抽出してタグ化
- エラーハンドリング
  - フィード取得失敗時のリトライ（指数バックオフ）
  - パースエラー・DB接続エラーのログ記録と再試行

## その他
- favicon 取得エンドポイント（ドメイン指定での取得）
- アナリティクス計測用のトラッキング（要否と手段は再検討）
