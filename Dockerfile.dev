FROM golang:1.25-bookworm

# Accept build arguments for user/group IDs
ARG USER_UID=1000
ARG USER_GID=1000

# Install development dependencies (make, bash, git, etc.)
RUN apt-get update && apt-get install -y --no-install-recommends \
    bash \
    ca-certificates \
    git \
    locales \
    make \
    postgresql-client \
    sudo \
    tzdata && \
    rm -rf /var/lib/apt/lists/*

# Configure Japanese locale
RUN sed -i -e 's/# ja_JP.UTF-8 UTF-8/ja_JP.UTF-8 UTF-8/' /etc/locale.gen && \
    locale-gen && \
    update-locale LANG=ja_JP.UTF-8

# Create non-root user for VS Code devcontainer with dynamic UID/GID
RUN groupadd -g ${USER_GID} vscode && \
    useradd -m -d /home/vscode -u ${USER_UID} -g vscode vscode && \
    echo "vscode ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/vscode && \
    chmod 0440 /etc/sudoers.d/vscode

WORKDIR /workspace

USER vscode

CMD ["sleep", "infinity"]
